# App configuration
general:
  lang: pt_BR
  instanceId: instance1
  suffix: dc=example,dc=com
  adminPassword: admin
  updateDelayInSecs: 300
  
sourceParameters:
- type: sql
  dbUsername: "dbuser"
  dbPassword: "dbpass"
  dbServer: localhost
  dbPort: 3306

sources:
- id: ldap1
  type: proxy
  suffix: dc=example,dc=com
  targetURI: "ldap://dev.local:10389"
  aclBind: binddn="cn=admin,dc=example,dc=com" credentials="admin"

- id: sql_users
  enabled: true
  suffix: ou=dbusers,dc=example,dc=com
  sourceJdbcURL: "jdbc:mariadb://dev.local:3306/sourcedb"
  sourceUsername: "sourceuser"
  sourcePassword: "sourcepassword"
  batchMode: false
  dnFormat: uid=%s
  type: sql
  query: select uid, concat(name, ' ', surname) as full_name, name, surname, phone, email, 0 as cpf, 0 as atualizar from users
  idColumn: uid
  attributes:
  - givenName=name
  - sn=surname
  - cn=uid
  - telephoneNumber=phone
  - mail=email
  - cpf=cpf
  - atualizar=atualizar
  objectClasses:
  - inetOrgPerson
  - energiaInetOrgPerson
  joinData:
  - id: data1
    query: >- 
        select concat('cn=',a.groupname, ',dc=example,dc=com') as groupname, b.uid
        from groups a 
        inner join users b
        on a.userid = b.userid
    joinColumns: uid=uid
    attributes:
    - memberOf=groupname
    indexCols:
    - groupname
    # Column from projection used to identify the match with parent source
    idColumn: uid
    
# - id: sql_users
#   enabled: true
#   suffix: ou=users,dc=example,dc=org
#   sourceJdbcURL: "jdbc:mariadb://dev.local:3306/source"
#   sourceUsername: "dbuser"
#   sourcePassword: "userpass"
#   dnFormat: uid=%s
#   type: sql
#   query: select username, concat(name, ' ', surname) as full_name, name, surname, phone, email from users
#   idColumn: username
#   attributes:
#   - givenName=name
#   - sn=surname
#   - cn=username
#   - telephoneNumber=phone
#   - mail=email
#   joinData:
#   - id: data1
#     query: >- 
#         select a.groupname , a.username
#         from groups a 
#         inner join users b
#         on a.username = b.username
#     joinColumns: username=username
#     attributes:
#     - memberOf=groupname
#     idColumn: username
#   objectClasses: 
#   - inetOrgPerson
# - id: sql_groups
#   enabled: true
#   suffix: ou=groups,dc=example,dc=org
#   dnFormat: cn=%s
#   type: sql
#   sourceJdbcURL: "jdbc:mariadb://dev.local:3306/source"
#   sourceUsername: "dbuser"
#   sourcePassword: "userpass"
#   query: select groupname from groups
#   idColumn: groupname
#   attributes:
#   - cn=groupname
#   joinData:
#   - id: data2
#     query: >- 
#         select distinct a.groupname, a.username
#         from groups a 
#     joinColumns: groupname
#     idColumn: username 
#     attributes:
#     - member=username
#   objectClasses: 
#   - groupOfNames
  