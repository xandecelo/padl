# App configuration
general:
  lang: pt_BR
  instanceId: instance1
  suffix: dc=example,dc=org
  adminPassword: admin

sourceParameters:
- type: sql
  dbUsername: dbuser
  dbPassword: userpass
  dbServer: dev.local
  dbPort: 3306
  dbDatabase: backsql

sources:
- id: ldap1
  type: proxy
  suffix: dc=ldap,dc=example,dc=org
  targetURI: "ldap://dev.local:10389"
  aclBind: binddn="cn=admin,dc=test,dc=com" credentials="admin"
- id: sql_users
  enabled: true
  suffix: ou=users,dc=example,dc=org
  dnFormat: uid=%s
  type: sql
  query: select username, concat(first_name, ' ', surname) as full_name, first_name, surname, phone from users
  idColumn: username
  attributes:
  - givenName=first_name
  - sn=surname
  - cn=username
  - telephoneNumber=phone
  joinData:
  - id: data1
    query: >- 
        select c.username, a.groupname 
        from groups a 
            inner join group_users b
            on a.groupid = b.groupid
            inner join users c
            on b.username = c.username
    joinColumns: username=username
    attributes:
    - memberOf=a.groupname
  objectClasses: 
  - inetOrgPerson
- id: sql_groups
  enabled: true
  suffix: ou=groups,dc=example,dc=org
  dnFormat: cn=%s
  type: sql
  query: select group_name from groups
  idColumn: group_name
  attributes:
  joinData:
  - id: data2
    query: >- 
        select c.username, a.groupname 
        from groups a 
            inner join group_users b
            on a.groupid = b.groupid
            inner join users c
            on b.username = c.username
    joinColumns: groupname
    idColumn: username 
    attributes:
    - member=username
  objectClasses: 
  - groupOfNames
  